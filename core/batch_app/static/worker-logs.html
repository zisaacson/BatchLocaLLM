<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worker Logs - vLLM Batch Server</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
        }
        
        .header {
            background: #252526;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 {
            color: #fff;
            font-size: 20px;
            font-weight: 600;
        }
        
        .controls {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            background: #0e639c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: background 0.2s;
        }
        
        .btn:hover {
            background: #1177bb;
        }
        
        .btn-secondary {
            background: #3e3e42;
        }
        
        .btn-secondary:hover {
            background: #4e4e52;
        }
        
        .log-container {
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 8px;
            padding: 20px;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            font-size: 13px;
            line-height: 1.6;
        }
        
        .log-line {
            margin-bottom: 4px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .log-line.error {
            color: #f48771;
        }
        
        .log-line.warning {
            color: #dcdcaa;
        }
        
        .log-line.info {
            color: #4ec9b0;
        }
        
        .log-line.debug {
            color: #858585;
        }
        
        .timestamp {
            color: #858585;
            margin-right: 10px;
        }
        
        .search-box {
            background: #3e3e42;
            border: 1px solid #555;
            color: #d4d4d4;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 13px;
            width: 300px;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #0e639c;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            font-size: 12px;
            color: #858585;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .stat-value {
            color: #4ec9b0;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìÑ Worker Logs</h1>
        <div class="controls">
            <input type="text" class="search-box" id="search-box" placeholder="Search logs...">
            <button class="btn" onclick="refreshLogs()">üîÑ Refresh</button>
            <button class="btn btn-secondary" onclick="downloadLogs()">‚¨áÔ∏è Download</button>
            <button class="btn btn-secondary" onclick="window.close()">‚úï Close</button>
        </div>
    </div>
    
    <div class="stats">
        <div class="stat-item">
            <span>Total Lines:</span>
            <span class="stat-value" id="total-lines">0</span>
        </div>
        <div class="stat-item">
            <span>Errors:</span>
            <span class="stat-value" id="error-count">0</span>
        </div>
        <div class="stat-item">
            <span>Warnings:</span>
            <span class="stat-value" id="warning-count">0</span>
        </div>
        <div class="stat-item">
            <span>Last Updated:</span>
            <span class="stat-value" id="last-updated">Never</span>
        </div>
    </div>
    
    <div class="log-container" id="log-container">
        <div class="log-line">Loading logs...</div>
    </div>
    
    <script>
        let allLogs = [];
        let searchTerm = '';
        
        async function fetchLogs() {
            try {
                const response = await fetch('/admin/worker-logs/content');
                const data = await response.json();
                
                allLogs = data.logs || [];
                updateStats(data);
                renderLogs();
                
            } catch (error) {
                console.error('Error fetching logs:', error);
                document.getElementById('log-container').innerHTML = 
                    '<div class="log-line error">Error loading logs: ' + error.message + '</div>';
            }
        }
        
        function updateStats(data) {
            document.getElementById('total-lines').textContent = data.total_lines || 0;
            document.getElementById('error-count').textContent = data.error_count || 0;
            document.getElementById('warning-count').textContent = data.warning_count || 0;
            document.getElementById('last-updated').textContent = new Date().toLocaleTimeString();
        }
        
        function renderLogs() {
            const container = document.getElementById('log-container');
            
            // Filter logs by search term
            let filteredLogs = allLogs;
            if (searchTerm) {
                filteredLogs = allLogs.filter(log => 
                    log.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }
            
            if (filteredLogs.length === 0) {
                container.innerHTML = '<div class="log-line">No logs found</div>';
                return;
            }
            
            // Render logs
            container.innerHTML = filteredLogs.map(line => {
                const logClass = getLogClass(line);
                return `<div class="log-line ${logClass}">${escapeHtml(line)}</div>`;
            }).join('');
            
            // Auto-scroll to bottom
            container.scrollTop = container.scrollHeight;
        }
        
        function getLogClass(line) {
            if (line.includes('ERROR') || line.includes('‚ùå') || line.includes('Failed')) {
                return 'error';
            } else if (line.includes('WARNING') || line.includes('‚ö†Ô∏è')) {
                return 'warning';
            } else if (line.includes('INFO') || line.includes('‚úì')) {
                return 'info';
            } else if (line.includes('DEBUG')) {
                return 'debug';
            }
            return '';
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function refreshLogs() {
            fetchLogs();
        }
        
        function downloadLogs() {
            const blob = new Blob([allLogs.join('\n')], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `worker-logs-${new Date().toISOString()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // Search functionality
        document.getElementById('search-box').addEventListener('input', (e) => {
            searchTerm = e.target.value;
            renderLogs();
        });
        
        // Initial fetch
        fetchLogs();
        
        // Auto-refresh every 5 seconds
        setInterval(fetchLogs, 5000);
    </script>
</body>
</html>

