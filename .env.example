# ============================================================================
# vLLM Batch Server - Environment Configuration
# ============================================================================
# Copy this file to .env and customize for your environment
# cp .env.example .env

# ============================================================================
# Application
# ============================================================================
APP_NAME="vLLM Batch Server"
APP_VERSION="1.0.0"
ENVIRONMENT=development  # development, staging, production

# ============================================================================
# Batch API Server
# ============================================================================
BATCH_API_HOST=0.0.0.0
BATCH_API_PORT=4080
BATCH_API_WORKERS=1
BATCH_API_RELOAD=true  # Auto-reload on code changes (dev only)

# ============================================================================
# Curation API Server
# ============================================================================
CURATION_API_HOST=0.0.0.0
CURATION_API_PORT=8001
CURATION_API_WORKERS=1
CURATION_API_RELOAD=true

# ============================================================================
# Integration/Static Server
# ============================================================================
INTEGRATION_SERVER_HOST=0.0.0.0
INTEGRATION_SERVER_PORT=4081

# ============================================================================
# Label Studio
# ============================================================================
LABEL_STUDIO_URL=http://localhost:8080
LABEL_STUDIO_API_KEY=  # Leave empty to auto-generate
LABEL_STUDIO_TIMEOUT=30
LABEL_STUDIO_MAX_RETRIES=3
LABEL_STUDIO_RETRY_BACKOFF=1  # Backoff factor (1s, 2s, 4s, ...)
LABEL_STUDIO_POOL_CONNECTIONS=10  # Connection pool size
LABEL_STUDIO_POOL_MAXSIZE=20  # Max connections in pool

# ============================================================================
# Database
# ============================================================================
DATABASE_DIR=data/database
DATABASE_NAME=batch_jobs.db
DATABASE_ECHO=false  # Set to true to log SQL queries

# ============================================================================
# Storage Paths
# ============================================================================
DATA_DIR=data
BATCHES_DIR=data/batches
INPUT_DIR=data/batches/input
OUTPUT_DIR=data/batches/output
LOGS_DIR=data/batches/logs
FILES_DIR=data/files
MODELS_DIR=models
BENCHMARKS_DIR=benchmarks/results

# ============================================================================
# Batch Processing
# ============================================================================
MAX_REQUESTS_PER_JOB=50000  # OpenAI limit
MAX_QUEUE_DEPTH=0  # Max concurrent jobs (0 = unlimited, worker processes sequentially)
MAX_TOTAL_QUEUED_REQUESTS=0  # Max total requests across all queued jobs (0 = unlimited)
WORKER_POLL_INTERVAL=5  # Seconds between job checks
WORKER_HEARTBEAT_INTERVAL=30  # Seconds between heartbeats
CHUNK_SIZE=5000  # Process N requests at a time (proven safe from benchmarks)

# ============================================================================
# Auto-Import to Curation
# ============================================================================
AUTO_IMPORT_TO_CURATION=true
CURATION_API_URL=http://localhost:8001

# ============================================================================
# Webhooks
# ============================================================================
WEBHOOK_TIMEOUT=30
WEBHOOK_MAX_RETRIES=3
WEBHOOK_RETRY_DELAY=5

# ============================================================================
# vLLM Engine
# ============================================================================
DEFAULT_MODEL=google/gemma-2-2b-it
GPU_MEMORY_UTILIZATION=0.90
MAX_MODEL_LEN=8192
TENSOR_PARALLEL_SIZE=1
TRUST_REMOTE_CODE=true

# ============================================================================
# Monitoring
# ============================================================================
PROMETHEUS_PORT=4022
PROMETHEUS_URL=http://localhost:4022
GRAFANA_PORT=3000
GRAFANA_URL=http://localhost:3000
ENABLE_PROMETHEUS=true
ENABLE_GPU_MONITORING=true

# ============================================================================
# Logging
# ============================================================================
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT="%(asctime)s - %(name)s - %(levelname)s - %(message)s"
LOG_FILE=  # Leave empty to log to stdout only

# ============================================================================
# Security
# ============================================================================
API_KEY=  # Leave empty for no authentication (dev only)
CORS_ORIGINS=["*"]  # Comma-separated list or ["*"] for all
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=["*"]
CORS_ALLOW_HEADERS=["*"]

# ============================================================================
# External Services (for Aris integration)
# ============================================================================
# Set these if integrating with Aris app
ARIS_APP_URL=  # e.g., http://10.0.0.223:4000
ARIS_WEBHOOK_URL=  # e.g., http://10.0.0.223:4000/api/ml/batch/webhook

# ============================================================================
# Feature Flags
# ============================================================================
ENABLE_AUTO_IMPORT=true
ENABLE_WEBHOOKS=true
ENABLE_BENCHMARKING=true
ENABLE_STATIC_SERVER=true

# ============================================================================
# Production Example
# ============================================================================
# For production deployment, use these settings:
#
# ENVIRONMENT=production
# BATCH_API_RELOAD=false
# CURATION_API_RELOAD=false
# DATABASE_ECHO=false
# LOG_LEVEL=WARNING
# LOG_FILE=logs/app.log
# API_KEY=your-secret-api-key-here
# CORS_ORIGINS=["https://your-domain.com"]
# LABEL_STUDIO_URL=http://label-studio:8080
# PROMETHEUS_URL=http://prometheus:9090
# GRAFANA_URL=http://grafana:3000

